#!/bin/bash

# run 2 cue commands on files and option --schema

# Initialize variables
FILES=()
SCHEMA=""

# Function to print error message and exit
print_error() {
    echo "$1" >&2
    exit 1
}

# Parse command line arguments
while [[ $# -gt 0 ]]; do
    case "$1" in
    --schema)
        shift
        SCHEMA="$1"
        ;;
    *)
        FILES+=("$1")
        ;;
    esac
    shift
done

# Check if any FILES were provided
if [[ ${#FILES[@]} -eq 0 ]]; then
    print_error "Error: No FILES provided."
fi

# Check if --schema argument is missing
if [[ -z $SCHEMA ]]; then
    print_error "Error: --schema argument is missing."
fi

# Display collected FILES and SCHEMA value
echo "FILES: ${FILES[@]}"
echo "SCHEMA: $SCHEMA"

set -x
cue eval "${FILES[@]}" --expression "$SCHEMA"
cue vet "${FILES[@]}" --schema "$SCHEMA"
